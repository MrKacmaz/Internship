<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"
        integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js"
        integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <!-- Sweet alert src -->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
            <path
                d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" />
        </symbol>
    </svg>

    <div class="showCoinImage">
        <div class="container">
            <div class="row justify-content-md-center">
                <div class="col text-center coin">
                    <img src="https://bitcoin.org/img/icons/opengraph.png?1625145073" alt="BTC COIN" height="100px"
                        width="100px">
                    <p class="text-center">BIT COIN</p>
                    <p id="btcRateP" class="text-center"></p>
                </div>
                <div class="col text-center coin">
                    <img src="https://static.coincost.net/logo/cryptocurrency/ethereum-classic.png" alt="ETC COIN"
                        height="100px" width="100px">
                    <p class="text-center">ETHEREUM</p>
                    <p id="etcRateP" class="text-center"></p>
                </div>
                <div class="col text-center coin">
                    <img src="https://kriptomaymunu.com/wp-content/uploads/2021/05/cardano-ada-coin-icon.png"
                        alt="ADA COIN" height="100px" width="100px">
                    <p class="text-center">ADA COIN</p>
                    <p id="adaRateP" class="text-center"></p>
                </div>
            </div>
        </div>
    </div>

    <div class="modalDiv">
        <!-- Button trigger modal -->
        <div class="d-grid gap-2 col-6 mx-auto">
            <button type="button" class="btn btn-outline-success btn-lg" data-bs-toggle="modal"
                data-bs-target="#staticBackdrop">
                Buy Coin
            </button>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">MrKacmaz Coin Purchase System</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Modal Body Page Start -->
                        <div class="buy">

                            <div class="select">
                                <div class="input-group mb-3">
                                    <select id="coinSelectBox" class="form-select">
                                        <option selected>Open Coin Menu</option>
                                    </select>
                                </div>
                            </div>

                            <div class="valueInput">

                                <div class="input-group mb-3">
                                    <span class="input-group-text" id="basic-addon1">Rate</span>
                                    <input id="rateInput" type="text" class="form-control">
                                </div>

                                <div class="input-group mb-3">
                                    <span class="input-group-text" id="basic-addon1">Piece</span>
                                    <input id="pieceInput" type="number" class="form-control">

                                    <span class="input-group-text" id="basic-addon1">Money</span>
                                    <input id="moneyInput" type="number" class="form-control">

                                </div>
                                <div class="alert alert-primary d-flex align-items-center" role="alert">
                                    <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img"
                                        aria-label="Info:">
                                        <use xlink:href="#info-fill" />
                                    </svg>
                                    <div>
                                        You can buy coin with number of pieces or amount of money
                                    </div>
                                </div>

                            </div>

                        </div>
                        <!-- Modal Body Page End -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" onclick="buyOperation()">Buy</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="sellModal">

        <!-- Modal -->
        <div class="modal fade" id="sellModalBtn" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">Modal title</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- modal input start -->

                        <!-- coin name (disabled) -->
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="inputGroup-sizing-default">Coin Name</span>
                            <input type="text" class="form-control" id="modalCoinName">
                        </div>

                        <!-- coin first rate (disabled)-->
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="inputGroup-sizing-default">Claim Rate</span>
                            <input type="number" class="form-control" id="modalCoinFirstRate">
                        </div>

                        <!-- coin final rate (disabled) -->
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="inputGroup-sizing-default">Sell Rate</span>
                            <input type="number" class="form-control" id="modalCoinFinalRate">
                        </div>

                        <!-- coin sell amount -->
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="inputGroup-sizing-default">Sell Amount</span>
                            <input type="number" class="form-control" id="modalCoinSellAmount">
                        </div>

                        <!-- coin sell amount price (disabled) -->
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="inputGroup-sizing-default">Price</span>
                            <input type="number" class="form-control" id="modalCoinSellPrice">
                        </div>

                        <!-- modal input end -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" onclick="extractionProcess()">Sell</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="accordingDiv">

        <div class="accordion accordion-flush" id="accordionFlushExample">
            <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingOne">
                    <button class="accordion-button collapsed acrdBtn" type="button" data-bs-toggle="collapse"
                        data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                        <p>Coin Wallet</p>
                    </button>
                </h2>
                <div id="flush-collapseOne" class="accordion-collapse collapse acrdDiv"
                    aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                    <div class="accordion-body">
                        <!-- Table Body Start -->
                        <div class="showTable">

                            <table class="table table-dark table-striped table-borderless">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Coin name</th>
                                        <th scope="col">Coin Rate</th>
                                        <th scope="col">Piece</th>
                                        <th scope="col">Total</th>
                                        <th scope="col">Transaction</th>
                                    </tr>
                                </thead>
                                <tbody id="tbody">

                                </tbody>
                            </table>

                        </div>
                        <!-- Table Body End -->
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion accordion-flush" id="accordionFlushSell">
            <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingOne">
                    <button class="accordion-button collapsed acrdBtn" type="button" data-bs-toggle="collapse"
                        data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                        <p>Operations</p>
                    </button>
                </h2>
                <div id="flush-collapseTwo" class="accordion-collapse collapse acrdDiv"
                    aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushSell">
                    <div class="accordion-body">
                        <!-- Table Body Start -->
                        <div class="showTable">

                            <table class="table table-dark table-striped table-borderless">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Coin name</th>
                                        <th scope="col">Coin Rate</th>
                                        <th scope="col">Piece</th>
                                        <th scope="col">Total</th>
                                        <th scope="col">Operations</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyOperation">

                                </tbody>

                                <tfoot>
                                    <tr>
                                        <td>SUM</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td>
                                            <button type="button" class="btn btn-primary"
                                                onclick="buyCoinsBtn()">Buy</button>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>

                        </div>
                        <!-- Table Body End -->
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion accordion-flush" id="accordionFlushProfit">
            <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingThree">
                    <button class="accordion-button collapsed acrdBtn" type="button" data-bs-toggle="collapse"
                        data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
                        <p>Profit</p>
                    </button>
                </h2>
                <div id="flush-collapseThree" class="accordion-collapse collapse acrdDiv"
                    aria-labelledby="flush-headingThree" data-bs-parent="#accordionFlushProfit">
                    <div class="accordion-body">
                        <!-- Table Body Start -->
                        <table class="table table-dark table-striped table-borderless">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Coin name</th>
                                    <th>Coin Buy Rate</th>
                                    <th>Coin Buy Piece</th>
                                    <th>Coin Sell Rate</th>
                                    <th>Coin Sell Piece</th>
                                    <th>Profit</th>
                                </tr>
                            </thead>
                            <tbody id="tbodyProfit"></tbody>
                        </table>
                        <!-- Table Body End -->
                    </div>
                </div>
            </div>
        </div>

    </div>


    <script>
        var selectedCoinName, selectedCoinRate, piece, money, currentSpending, counter = 0, counterProfit = 0, claimAllCoinMoney = 0;
        var totalCoinsArray = new Array();
        var btcFirst, etcFirst, adaFirst;
        var btcFinal, etcFinal, adaFinal;

        var etcHtml = 'https://rest.coinapi.io/v1/exchangerate/ETC/USD?apikey=BCCFF263-DE21-4A96-97B5-9EE4AD1FA495';
        var btcHtml = 'https://rest.coinapi.io/v1/exchangerate/BTC/USD?apikey=BCCFF263-DE21-4A96-97B5-9EE4AD1FA495';
        var adaHtml = 'https://rest.coinapi.io/v1/exchangerate/ADA/USD?apikey=BCCFF263-DE21-4A96-97B5-9EE4AD1FA495';
        var key = 'BCCFF263-DE21-4A96-97B5-9EE4AD1FA495';

        // IMOPRTANT
        var uniqueCounter;
        // coin sell btn functions' variables
        var coinSellName, first, coinBuyPiece, final, coinSellPiece, profit, selectedCoinPiece;

        // for error
        var selectedCoinSellName;

        $(document).ready(function () {
            showAllCoin();
        });

        function showAllCoin() {

            // GET BTC
            $.ajax({
                url: btcHtml,
                type: 'GET',
                headers: {
                    'apikey': key
                },
                data: {

                },
                beforeSend: function () {

                },
                success: function (data) {
                    console.log("BTC = " + data.rate);
                    $('#coinSelectBox').append($('<option >', {
                        value: data.rate,
                        text: data.asset_id_base,
                        id: data.asset_id_base,
                        name: data.asset_id_base
                    }));
                    $("#btcRateP").text("$ " + data.rate);
                    if (isNaN(btcFirst)) {
                        btcFirst = data.rate;
                    }
                    btcFinal = data.rate;
                }
            });

            // GET ETC
            $.ajax({
                url: etcHtml,
                type: 'GET',
                headers: {
                    'apikey': key
                },
                data: {

                },
                beforeSend: function () {

                },
                success: function (data) {
                    console.log("ETC = " + data.rate);
                    $('#coinSelectBox').append($('<option >', {
                        value: data.rate,
                        text: data.asset_id_base,
                        id: data.asset_id_base,
                        name: data.asset_id_base
                    }));
                    $("#etcRateP").text("$ " + data.rate);
                    if (isNaN(etcFirst)) {
                        etcFirst = data.rate;
                    }
                    etcFinal = data.rate;
                }
            });

            // GET ADA
            $.ajax({
                url: adaHtml,
                type: 'GET',
                headers: {
                    'apikey': key
                },
                data: {

                },
                beforeSend: function () {

                },
                success: function (data) {
                    console.log("ADA = " + data.rate);
                    $('#coinSelectBox').append($('<option >', {
                        value: data.rate,
                        text: data.asset_id_base,
                        id: data.asset_id_base,
                        name: data.asset_id_base
                    }));
                    $("#adaRateP").text("$ " + data.rate);
                    if (isNaN(adaFirst)) {
                        adaFirst = data.rate;
                    }
                    adaFinal = data.rate;
                }
            });
        }

        // Select box operations
        $('#coinSelectBox').change(function () {
            $("#rateInput").val($(this).val());
            $("#rateInput").attr("disabled", true);
            selectedCoinRate = $(this).val();
            selectedCoinName = $(this).find('option:selected').attr("name");
        });


        function buyOperation() {
            piece = $("#pieceInput").val();
            money = $("#moneyInput").val();
            var currentCoinArray;
            if (piece == "") {
                alert(parseFloat((money / selectedCoinRate)))
                currentSpending = money;
                currentCoinArray = [selectedCoinName, selectedCoinRate, parseFloat((money / selectedCoinRate)), currentSpending];
                totalCoinsArray.push(currentCoinArray);
                clearInputs();
                addRowToTable(currentCoinArray);
            } else {
                currentSpending = piece * selectedCoinRate;
                currentCoinArray = [selectedCoinName, selectedCoinRate, piece, currentSpending];
                totalCoinsArray.push(currentCoinArray);
                clearInputs();
                addRowToTable(currentCoinArray);
            }
        }

        function clearInputs() {
            $("input").val("");
            $("input").attr("disabled", false);
        }

        function addRowToTable(currentCoinArray) {

            claimAllCoinMoney += parseInt(currentCoinArray[3]);

            $("#tbody").append(
                '<tr id = tr-' + counter + '>' +
                '<td id= ' + counter + '>' + (counter + 1) + '</td>' +
                '<td id= ' + counter + '>' + currentCoinArray[0] + '</td>' +
                '<td id= ' + counter + '>' + parseFloat(currentCoinArray[1]).toFixed(2) + '</td>' +
                '<td id= ' + counter + '>' + currentCoinArray[2] + '</td>' +
                '<td id= ' + counter + '>' + parseFloat(currentCoinArray[3]).toFixed(2) + '</td>' +
                '<td id= ' + counter + '> BUY </td>' +
                '</tr>'
            );

            $("#tbodyOperation").append(
                '<tr id = tr-' + counter + '>' +
                '<td id= ' + counter + '>' + (counter + 1) + '</td>' +
                '<td id= ' + counter + '>' + currentCoinArray[0] + '</td>' +
                '<td id= ' + counter + '>' + parseFloat(currentCoinArray[1]).toFixed(2) + '</td>' +
                '<td id= ' + counter + '>' + currentCoinArray[2] + '</td>' +
                '<td id= ' + counter + '>' + parseFloat(currentCoinArray[3]).toFixed(2) + '</td>' +
                '<td id= sell-' + counter + '>' + '<button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#sellModalBtn" onclick="coinSellBtn(this)">Sell</button>' + '</td>' +
                '</tr>'
            );

            counter++;
        }

        function buyCoinsBtn() {
            swal("Payment Successful!", "Thank you for using MrKacmaz Coin System!", "success");
        }

        function coinSellBtn(incomeUniqueCounter) {
            uniqueCounter = incomeUniqueCounter;
            showAllCoin();

            // the selected amount is subtracted from all money 
            let selectedCoinSellPrice = $(uniqueCounter).parent().parent().children().eq(4).text();
            let selectedCoinFirstRate = $(uniqueCounter).parent().parent().children().eq(2).text();
            selectedCoinPiece = $(uniqueCounter).parent().parent().children().eq(3).text();
            selectedCoinSellName = $(uniqueCounter).parent().parent().children().eq(1).text();

            $("#modalCoinName").val(selectedCoinSellName);
            $("#modalCoinName").attr("disabled", true);
            $("#modalCoinFirstRate").val(selectedCoinFirstRate);
            $("#modalCoinFirstRate").attr("disabled", true);
            $("#modalCoinSellPrice").attr("disabled", true);
            if (selectedCoinSellName == "BTC") {
                $("#modalCoinFinalRate").val(btcFinal);
                $("#modalCoinFinalRate").attr("disabled", true);
            } else if (selectedCoinSellName == "ETC") {
                $("#modalCoinFinalRate").val(etcFinal);
                $("#modalCoinFinalRate").attr("disabled", true);
            } else if (selectedCoinSellName == "ADA") {
                $("#modalCoinFinalRate").val(adaFinal);
                $("#modalCoinFinalRate").attr("disabled", true);
            } else {
                swal("ERROR", "selectedCoinSellName Not Defined", "error");
            }

        }

        var selectedCoinSellPiece;
        $("#modalCoinSellAmount").on("input", function () {
            $("#modalCoinSellPrice").val($(this).val() * $("#modalCoinFinalRate").val())
            selectedCoinSellPiece = $(this).val();

        });

        function extractionProcess() {
            if ($("#modalCoinSellAmount").val() <= selectedCoinPiece) {
                swal({
                    title: "Are you sure?",
                    text: "Once you sell, you will not be able to recover this coin!",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                }).then((willDelete) => {
                    if (willDelete) {


                        switch (selectedCoinSellName) {

                            case "BTC":


                                claimAllCoinMoney = claimAllCoinMoney - (btcFinal * selectedCoinSellPiece);

                                coinSellName = selectedCoinSellName;
                                first = btcFirst;
                                coinBuyPiece = selectedCoinSellPiece;
                                final = btcFinal;
                                coinSellPiece = selectedCoinSellPiece;
                                profit = (btcFinal * selectedCoinSellPiece) - (btcFirst * selectedCoinSellPiece);
                                break;

                            case "ETC":


                                claimAllCoinMoney = claimAllCoinMoney - (etcFinal * selectedCoinSellPiece);

                                coinSellName = selectedCoinSellName;
                                first = etcFirst;
                                coinBuyPiece = selectedCoinSellPiece;
                                final = etcFinal;
                                coinSellPiece = selectedCoinSellPiece
                                profit = (etcFinal * selectedCoinSellPiece) - (etcFirst * selectedCoinSellPiece);
                                break;

                            case "ADA":

                                claimAllCoinMoney = claimAllCoinMoney - (adaFinal * selectedCoinSellPiece);

                                coinSellName = selectedCoinSellName;
                                first = adaFirst;
                                coinBuyPiece = selectedCoinSellPiece;
                                final = adaFinal;
                                coinSellPiece = selectedCoinSellPiece;
                                profit = (adaFinal * selectedCoinSellPiece) - (adaFirst * selectedCoinSellPiece);
                                break;

                            default:
                                swal("ERROR!", "extractionProcess() switch case error", "error");
                                break;
                        }



                        addRowInProfit();

                        addRowInCoinWalletSel()

                        // delet selected row
                        let rowInSweetAlert = uniqueCounter.parentNode.parentNode;
                        rowInSweetAlert.parentNode.removeChild(rowInSweetAlert);
                        swal("Successful! Your coin has been sold!", {
                            icon: "success",
                        });
                    } else {
                        swal("Your coin is safe!");
                    }
                });
            } else {
                swal("Amount Error!", "You don't have that many coins", "error");
            }
        }

        function addRowInProfit() {
            let bckColor;
            (profit > 0) ? bckColor = "green" : ((profit < 0) ? bckColor = "red" : bckColor = "orange");

            $("#tbodyProfit").append(
                '<tr id = trProfit-' + counterProfit + '>' +
                '<td id = tdProfitCounter-' + counterProfit + '>' + (counterProfit + 1) + '</td>' +
                '<td id = tdProfitCN-' + counterProfit + '>' + coinSellName + '</td>' +
                '<td id = tdProfitCBR-' + counterProfit + '>' + first + '</td>' +
                '<td id = tdProfitCBP-' + counterProfit + '>' + coinBuyPiece + '</td>' +
                '<td id = tdProfitCSR-' + counterProfit + '>' + final + '</td>' +
                '<td id = tdProfitCSP-' + counterProfit + '>' + coinSellPiece + '</td>' +
                '<td id = tdProfitP-' + counterProfit + ' style=" font-weight: bold; color:' + bckColor + '">' + profit + '</td>' +
                '</tr>'
            );
            counterProfit++;
        }

        function addRowInCoinWalletSel() {
            $("#tbody").append(
                '<tr id = tr-' + counter + '>' +
                '<td id= ' + counter + '>' + (counter + 1) + '</td>' +
                '<td id= ' + counter + '>' + coinSellName + '</td>' +
                '<td id= ' + counter + '>' + final + '</td>' +
                '<td id= ' + counter + '>' + coinSellPiece + '</td>' +
                '<td id= ' + counter + '>' + (final * coinSellPiece) + '</td>' +
                '<td id= ' + counter + '> SELL </td>' +
                '</tr>'
            );
        }
    </script>
</body>

</html>